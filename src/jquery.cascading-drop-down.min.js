/*
 * ssdCascadingDropDown jQuery plugin
 * Examples and documentation at: https://github.com/sebastiansulinski/cascading-dropdown
 * Copyright (c) 2015 Sebastian Sulinski
 * Version: 1.0.0 (03-MAR-2015)
 * Licensed under the MIT.
 * Requires: jQuery v1.9 or later
 */
!function(t){t.fn.ssdCascadingDropDown=function(a){"use strict";function e(t){return"undefined"==typeof t||""===t||t===!1||t.length<1}function r(t,a){return t in a}function n(t){t.preventDefault(),t.stopPropagation()}function u(a){return t("[data-"+L.attrDataGroup+'="'+a+'"]')}function i(a,e){return t("[data-"+L.attrDataGroup+'="'+a+'"][data-'+L.attrDataId+'="'+e+'"]')}function o(a,e){return t("[data-"+L.attrDataGroup+'="'+a+'"][data-'+L.attrDataTarget+'="'+e+'"]')}function l(a){return t("[data-"+L.attrDataReplacementContainer+'="'+a+'"]')}function c(t){var a={group:t.data(L.attrDataGroup),id:t.data(L.attrDataId),target:t.data(L.attrDataTarget),url:t.data(L.attrDataUrl),value:t.val(),replacementContainer:t.data(L.attrDataReplacement)};return a.targetObject=i(a.group,a.target),a.targetDefaultLabel=a.targetObject.data(L.attrDataDefaultLabel),a.parent=o(a.group,a.id),a.parentUrl=a.parent.data(L.attrDataUrl),a}function d(){var t='<option value="';return t+=e(arguments[1])?"":arguments[1],t+='">',t+=e(arguments[0])?"Select one":arguments[0],t+="</option>"}function f(t){return d(t)}function p(a,e){var r=t.Deferred(),n=e[L.indexMenu],u=f(a);return t.each(n,function(t,a){u+=d(a.name,a.value),t+1===n.length&&r.resolve(u)}),r.promise()}function s(t,a){var e=l(t);0!==e.length&&e.html(a)}function D(t,a,r){a.html(f(r)).prop("disabled",!0);var n=a.data(L.attrDataTarget);if(!e(n)){var u=i(t,n),o=u.data(L.attrDataDefaultLabel);u.length>0&&D(t,u,o)}}function g(a){var r=a.data(L.attrDataGroup),n=u(r).not(":disabled"),i=[];return t.each(n,function(){var a=t(this).val();e(a)||i.push({name:t(this).prop("name"),value:t(this).val()})}),i}function m(a){return t.param(a)}function h(t){if(!t)throw new Error("Invalid data received!");if(!t.success){if(!r(L.indexError,t))throw new Error("There was a problem with the request!");return L.errorCallback(t[L.indexError],t),!1}return!0}function v(a){return e(a.parent)||e(a.parentUrl)?void s(a.replacementContainer,""):void t.getJSON(a.parentUrl+"?"+m(a.selection),function(t){h(t)&&s(a.replacementContainer,t[L.indexReplacement])})}function b(a){t.getJSON(a.url+"?"+m(a.selection),function(e){h(e)&&(r(L.indexMenu,e)&&t.when(p(a.targetDefaultLabel,e)).then(function(t){a.targetObject.html(t).prop("disabled",!1)}),r(L.indexReplacement,e)&&s(a.replacementContainer,e[L.indexReplacement]))})}function x(a){a.on("change",function(a){if(n(a),!t(this).is(":disabled")){var r=c(t(this));if(!e(r.url))return e(r.target)||D(r.group,r.targetObject,r.targetDefaultLabel),r.selection=g(t(this)),e(r.value)?void v(r):void b(r)}})}function w(t){t.html(f(t.data(L.attrDataDefaultLabel))).prop("disabled",!0)}function C(t,a){return!e(a.attr(t))}function R(a){var e=t.Deferred(),r=[L.attrDataGroup,L.attrDataId,L.attrDataUrl,L.attrDataTarget,L.attrDataDefaultLabel,L.attrDataReplacement];return L.verify?t.each(r,function(t,n){n="data-"+n,C(n,a)||console.log(a.prop("name")+" is missing attribute "+n),t+1===r.length&&e.resolve()}):e.resolve(),e.promise()}var L=t.extend({attrDataGroup:"group",attrDataId:"id",attrDataUrl:"url",attrDataTarget:"target",attrDataDefaultLabel:"default-label",attrDataReplacement:"replacement",attrDataReplacementContainer:"replacement-container",indexSuccess:"success",indexError:"error",indexMenu:"menu",indexReplacement:"replacement",verify:!0,errorCallback:function(t){console.warn(t)}},a);return this.each(function(){var a=t(this);w(a.not(":enabled")),t.when(R(a)).then(function(){x(a)})})}}(jQuery);