/*
 * ssdCascadingDropDown jQuery plugin
 * Examples and documentation at: https://github.com/sebastiansulinski/cascading-dropdown
 * Copyright (c) 2016 Sebastian Sulinski
 * Version: 1.4.1 (12-OCT-2016)
 * Licensed under the MIT.
 * Requires: jQuery v1.9 or later
 */
!function(a,b){a.fn.ssdCascadingDropDown=function(c){"use strict";function f(a){return a===b||""===a||a===!1||a.length<1}function g(a,b){return a in b}function h(a){a.preventDefault(),a.stopPropagation()}function i(b){return a("[data-"+e.attrDataGroup+'="'+b+'"]')}function j(b,c){return a("[data-"+e.attrDataGroup+'="'+b+'"][data-'+e.attrDataId+'="'+c+'"]')}function k(b,c){return a("[data-"+e.attrDataGroup+'="'+b+'"][data-'+e.attrDataTarget+'="'+c+'"]')}function l(b){return a("[data-"+e.attrDataReplacementContainer+'="'+b+'"]')}function m(a){var c={group:a.data(e.attrDataGroup),id:a.data(e.attrDataId),target:a.data(e.attrDataTarget),url:a.data(e.attrDataUrl),value:a.val(),isValueEmpty:function(){return f(this.value)},replacementContainer:a.data(e.attrDataReplacement),final:a.data("final"),isFinal:function(){return this.final!==b}};return c.targetObject=j(c.group,c.target),c.targetDefaultLabel=c.targetObject.data(e.attrDataDefaultLabel),c.parent=k(c.group,c.id),c.parentUrl=c.parent.data(e.attrDataUrl),c}function n(){var a='<option value="';return a+=f(arguments[1])?"":arguments[1],a+='">',a+=f(arguments[0])?"Select one":arguments[0],a+="</option>"}function o(a){return n(a)}function p(a,b){return d.formatOptions(a,b[e.indexMenu])}function q(a,b){var c=l(a);0!==c.length&&(f(b)&&(b=c.data(e.attrDataReplacementDefault)),c.html(b))}function r(a,b,c){b.html(o(c)).prop("disabled",!0);var d=b.data(e.attrDataTarget);if(!f(d)){var g=j(a,d),h=g.data(e.attrDataDefaultLabel);g.length>0&&r(a,g,h)}}function s(b){var c=b.data(e.attrDataGroup),d=i(c).not(":disabled"),g=[];return a.each(d,function(){var b=a(this).val();f(b)||g.push({name:a(this).prop("name"),value:a(this).val()})}),g}function t(b){return a.param(b)}function u(a){if(!a)throw new Error("Invalid data received!");if(!a.success){if(!g(e.indexError,a))throw new Error("There was a problem with the request!");return e.errorCallback(a[e.indexError],a),!1}return!0}function v(a,b){return b.isFinal()?e.finalEmptyCallback(a,b,d):e.nonFinalEmptyCallback(a,b,d)}function w(b,c){return v(b,c),f(c.parent)||f(c.parentUrl)?void q(c.replacementContainer,""):void a.getJSON(c.parentUrl+"?"+t(c.selection),function(a){u(a)&&(x(b,c,a),q(c.replacementContainer,a[e.indexReplacement]))})}function x(a,b,c){return b.isFinal()?e.finalCallback(a,b,c,d):e.nonFinalCallback(a,b,c,d)}function y(b,c){e.startCall(b,c),a.ajax({dataType:"json",url:c.url+"?"+t(c.selection),success:function(d){e.endCall(b,c),u(d)&&(x(b,c,d),g(e.indexMenu,d)&&a.when(p(c.targetDefaultLabel,d)).then(function(a){c.targetObject.html(a).prop("disabled",!1)}),g(e.indexReplacement,d)&&q(c.replacementContainer,d[e.indexReplacement]))},error:function(a,d,f){throw e.endCall(b,c),new Error(f)}})}function z(b){b.on("change",function(b){h(b);var c=a(this);if(!c.is(":disabled")){var d=m(c);if(!f(d.url))return f(d.target)||r(d.group,d.targetObject,d.targetDefaultLabel),d.selection=s(c),f(d.value)?void w(c,d):void y(c,d)}})}function A(a,b){return!f(b.attr(a))}function B(b){var c=a.Deferred(),d=[e.attrDataGroup,e.attrDataId,e.attrDataUrl,e.attrDataTarget,e.attrDataDefaultLabel,e.attrDataReplacement];return e.verify?a.each(d,function(a,e){e="data-"+e,A(e,b)||console.log(b.prop("name")+" is missing attribute "+e),a+1===d.length&&c.resolve()}):c.resolve(),c.promise()}function C(a){a.html(o(a.data(e.attrDataDefaultLabel))).prop("disabled",!0)}function D(){var b=a("."+e.classReplacementContainer);a.each(b,function(){a(this).html(a(this).data(e.attrDataReplacementDefault))})}var d=this,e=a.extend({attrDataGroup:"group",attrDataId:"id",attrDataUrl:"url",attrDataTarget:"target",attrDataDefaultLabel:"default-label",attrDataReplacement:"replacement",attrDataReplacementContainer:"replacement-container",attrDataReplacementDefault:"default-content",classReplacementContainer:"cascadingContainer",indexSuccess:"success",indexError:"error",indexMenu:"menu",indexReplacement:"replacement",verify:!0,startCall:function(a,b){},endCall:function(a,b){},nonFinalCallback:function(a,b,c,d){},nonFinalEmptyCallback:function(a,b,c){},finalCallback:function(a,b,c,d){},finalEmptyCallback:function(a,b,c){},errorCallback:function(a,b){console.warn(a)}},c);return this.formatOptions=function(b,c){var d=a.Deferred(),e=o(b);return a.each(c,function(a,b){e+=n(b.name,b.value),a+1===c.length&&d.resolve(e)}),d.promise()},D(),this.each(function(){var b=a(this);C(b.not(":enabled")),a.when(B(b)).then(function(){z(b)})})}}(jQuery);