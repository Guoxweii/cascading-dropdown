/*
 * ssdCascadingDropDown jQuery plugin
 * Examples and documentation at: https://github.com/sebastiansulinski/cascading-dropdown
 * Copyright (c) 2015 Sebastian Sulinski
 * Version: 1.2.3 (04-MAR-2015)
 * Licensed under the MIT.
 * Requires: jQuery v1.9 or later
 */
!function(t){t.fn.ssdCascadingDropDown=function(a){"use strict";function e(t){return"undefined"==typeof t||""===t||t===!1||t.length<1}function r(t,a){return t in a}function n(t){t.preventDefault(),t.stopPropagation()}function i(a){return t("[data-"+G.attrDataGroup+'="'+a+'"]')}function u(a,e){return t("[data-"+G.attrDataGroup+'="'+a+'"][data-'+G.attrDataId+'="'+e+'"]')}function o(a,e){return t("[data-"+G.attrDataGroup+'="'+a+'"][data-'+G.attrDataTarget+'="'+e+'"]')}function l(a){return t("[data-"+G.attrDataReplacementContainer+'="'+a+'"]')}function c(t){var a={group:t.data(G.attrDataGroup),id:t.data(G.attrDataId),target:t.data(G.attrDataTarget),url:t.data(G.attrDataUrl),value:t.val(),replacementContainer:t.data(G.attrDataReplacement)};return a.targetObject=u(a.group,a.target),a.targetDefaultLabel=a.targetObject.data(G.attrDataDefaultLabel),a.parent=o(a.group,a.id),a.parentUrl=a.parent.data(G.attrDataUrl),a}function d(){var t='<option value="';return t+=e(arguments[1])?"":arguments[1],t+='">',t+=e(arguments[0])?"Select one":arguments[0],t+="</option>"}function f(t){return d(t)}function p(a,e){var r=t.Deferred(),n=e[G.indexMenu],i=f(a);return t.each(n,function(t,a){i+=d(a.name,a.value),t+1===n.length&&r.resolve(i)}),r.promise()}function s(t,a){var r=l(t);0!==r.length&&(e(a)&&(a=r.data(G.attrDataReplacementDefault)),r.html(a))}function D(t,a,r){a.html(f(r)).prop("disabled",!0);var n=a.data(G.attrDataTarget);if(!e(n)){var i=u(t,n),o=i.data(G.attrDataDefaultLabel);i.length>0&&D(t,i,o)}}function m(a){var r=a.data(G.attrDataGroup),n=i(r).not(":disabled"),u=[];return t.each(n,function(){var a=t(this).val();e(a)||u.push({name:t(this).prop("name"),value:t(this).val()})}),u}function g(a){return t.param(a)}function h(t){if(!t)throw new Error("Invalid data received!");if(!t.success){if(!r(G.indexError,t))throw new Error("There was a problem with the request!");return G.errorCallback(t[G.indexError],t),!1}return!0}function v(a){return e(a.parent)||e(a.parentUrl)?void s(a.replacementContainer,""):void t.getJSON(a.parentUrl+"?"+g(a.selection),function(t){h(t)&&s(a.replacementContainer,t[G.indexReplacement])})}function b(a){t.getJSON(a.url+"?"+g(a.selection),function(e){h(e)&&(r(G.indexMenu,e)&&t.when(p(a.targetDefaultLabel,e)).then(function(t){a.targetObject.html(t).prop("disabled",!1)}),r(G.indexReplacement,e)&&s(a.replacementContainer,e[G.indexReplacement]))})}function R(a){a.on("change",function(a){if(n(a),!t(this).is(":disabled")){var r=c(t(this));if(!e(r.url))return e(r.target)||D(r.group,r.targetObject,r.targetDefaultLabel),r.selection=m(t(this)),e(r.value)?void v(r):void b(r)}})}function x(t,a){return!e(a.attr(t))}function C(a){var e=t.Deferred(),r=[G.attrDataGroup,G.attrDataId,G.attrDataUrl,G.attrDataTarget,G.attrDataDefaultLabel,G.attrDataReplacement];return G.verify?t.each(r,function(t,n){n="data-"+n,x(n,a)||console.log(a.prop("name")+" is missing attribute "+n),t+1===r.length&&e.resolve()}):e.resolve(),e.promise()}function w(t){t.html(f(t.data(G.attrDataDefaultLabel))).prop("disabled",!0)}function L(){var a=t("."+G.classReplacementContainer);t.each(a,function(){t(this).html(t(this).data(G.attrDataReplacementDefault))})}var G=t.extend({attrDataGroup:"group",attrDataId:"id",attrDataUrl:"url",attrDataTarget:"target",attrDataDefaultLabel:"default-label",attrDataReplacement:"replacement",attrDataReplacementContainer:"replacement-container",attrDataReplacementDefault:"default-content",classReplacementContainer:"cascadingContainer",indexSuccess:"success",indexError:"error",indexMenu:"menu",indexReplacement:"replacement",verify:!0,errorCallback:function(t){console.warn(t)}},a);return L(),this.each(function(){var a=t(this);w(a.not(":enabled")),t.when(C(a)).then(function(){R(a)})})}}(jQuery);