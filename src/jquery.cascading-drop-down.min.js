/*
 * ssdCascadingDropDown jQuery plugin
 * Examples and documentation at: https://github.com/sebastiansulinski/cascading-dropdown
 * Copyright (c) 2016 Sebastian Sulinski
 * Version: 1.4.2 (29-JAN-2017)
 * Licensed under the MIT.
 * Requires: jQuery v1.9 or later
 */
!function(a,b){"function"==typeof define&&define.amd?define(["jquery"],function(a){return b(a)}):"object"==typeof exports?module.exports=b(require("jquery")):b(a.jQuery)}(this,function(a){!function(){a.fn.ssdCascadingDropDown=function(b){"use strict";function e(a){return void 0===a||""===a||a===!1||a.length<1}function f(a,b){return a in b}function g(a){a.preventDefault(),a.stopPropagation()}function h(b){return a("[data-"+d.attrDataGroup+'="'+b+'"]')}function i(b,c){return a("[data-"+d.attrDataGroup+'="'+b+'"][data-'+d.attrDataId+'="'+c+'"]')}function j(b,c){return a("[data-"+d.attrDataGroup+'="'+b+'"][data-'+d.attrDataTarget+'="'+c+'"]')}function k(b){return a("[data-"+d.attrDataReplacementContainer+'="'+b+'"]')}function l(a){var b={group:a.data(d.attrDataGroup),id:a.data(d.attrDataId),target:a.data(d.attrDataTarget),url:a.data(d.attrDataUrl),value:a.val(),isValueEmpty:function(){return e(this.value)},replacementContainer:a.data(d.attrDataReplacement),final:a.data("final"),isFinal:function(){return void 0!==this.final}};return b.targetObject=i(b.group,b.target),b.targetDefaultLabel=b.targetObject.data(d.attrDataDefaultLabel),b.parent=j(b.group,b.id),b.parentUrl=b.parent.data(d.attrDataUrl),b}function m(){var a='<option value="';return a+=e(arguments[1])?"":arguments[1],a+='">',a+=e(arguments[0])?"Select one":arguments[0],a+="</option>"}function n(a){return m(a)}function o(a,b){return c.formatOptions(a,b[d.indexMenu])}function p(a,b){var c=k(a);0!==c.length&&(e(b)&&(b=c.data(d.attrDataReplacementDefault)),c.html(b))}function q(a,b,c){b.html(n(c)).prop("disabled",!0);var f=b.data(d.attrDataTarget);if(!e(f)){var g=i(a,f),h=g.data(d.attrDataDefaultLabel);g.length>0&&q(a,g,h)}}function r(b){var c=b.data(d.attrDataGroup),f=h(c).not(":disabled"),g=[];return a.each(f,function(){var b=a(this).val();e(b)||g.push({name:a(this).prop("name"),value:a(this).val()})}),g}function s(b){return a.param(b)}function t(a){if(!a)throw new Error("Invalid data received!");if(!a.success){if(!f(d.indexError,a))throw new Error("There was a problem with the request!");return d.errorCallback(a[d.indexError],a),!1}return!0}function u(a,b){return b.isFinal()?d.finalEmptyCallback(a,b,c):d.nonFinalEmptyCallback(a,b,c)}function v(b,c){return u(b,c),e(c.parent)||e(c.parentUrl)?void p(c.replacementContainer,""):void a.getJSON(c.parentUrl+"?"+s(c.selection),function(a){t(a)&&(w(b,c,a),p(c.replacementContainer,a[d.indexReplacement]))})}function w(a,b,e){return b.isFinal()?d.finalCallback(a,b,e,c):d.nonFinalCallback(a,b,e,c)}function x(b,c){d.startCall(b,c),a.ajax({dataType:"json",url:c.url+"?"+s(c.selection),success:function(e){d.endCall(b,c),t(e)&&(w(b,c,e),f(d.indexMenu,e)&&a.when(o(c.targetDefaultLabel,e)).then(function(a){c.targetObject.html(a).prop("disabled",!1)}),f(d.indexReplacement,e)&&p(c.replacementContainer,e[d.indexReplacement]))},error:function(a,e,f){throw d.endCall(b,c),new Error(f)}})}function y(b){b.on("change",function(b){g(b);var c=a(this);if(!c.is(":disabled")){var d=l(c);if(!e(d.url))return e(d.target)||q(d.group,d.targetObject,d.targetDefaultLabel),d.selection=r(c),e(d.value)?void v(c,d):void x(c,d)}})}function z(a,b){return!e(b.attr(a))}function A(b){var c=a.Deferred(),e=[d.attrDataGroup,d.attrDataId,d.attrDataUrl,d.attrDataTarget,d.attrDataDefaultLabel,d.attrDataReplacement];return d.verify?a.each(e,function(a,d){d="data-"+d,z(d,b)||console.log(b.prop("name")+" is missing attribute "+d),a+1===e.length&&c.resolve()}):c.resolve(),c.promise()}function B(a){a.html(n(a.data(d.attrDataDefaultLabel))).prop("disabled",!0)}function C(){var b=a("."+d.classReplacementContainer);a.each(b,function(){a(this).html(a(this).data(d.attrDataReplacementDefault))})}var c=this,d=a.extend({attrDataGroup:"group",attrDataId:"id",attrDataUrl:"url",attrDataTarget:"target",attrDataDefaultLabel:"default-label",attrDataReplacement:"replacement",attrDataReplacementContainer:"replacement-container",attrDataReplacementDefault:"default-content",classReplacementContainer:"cascadingContainer",indexSuccess:"success",indexError:"error",indexMenu:"menu",indexReplacement:"replacement",verify:!0,startCall:function(a,b){},endCall:function(a,b){},nonFinalCallback:function(a,b,c,d){},nonFinalEmptyCallback:function(a,b,c){},finalCallback:function(a,b,c,d){},finalEmptyCallback:function(a,b,c){},errorCallback:function(a,b){console.warn(a)}},b);return this.formatOptions=function(b,c){var d=a.Deferred(),e=n(b);return a.each(c,function(a,b){e+=m(b.name,b.value),a+1===c.length&&d.resolve(e)}),d.promise()},C(),this.each(function(){var b=a(this);B(b.not(":enabled")),a.when(A(b)).then(function(){y(b)})})}}()});